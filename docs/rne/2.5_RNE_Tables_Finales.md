# 2.5 – Modèle de données final RNE (SQLite)

## 1. Objectif
Documenter la structure des tables RNE présentes dans `rne_<date>.db` (base SQLite consolidée RNE) :
- liste des tables,
- colonnes et types,
- relations logiques entre tables,
- principaux index.

Seules les tables alimentées par les données RNE sont décrites ici.

---

## 2. Tables et colonnes

### 2.1 `unite_legale`

Table représentant l’unité légale (UL), identifiée par le SIREN.

**Colonnes principales**

- `siren` – TEXT  
- `denomination` – TEXT  
- `nom_commercial` – TEXT  
- `tranche_effectif_salarie` – TEXT  
- `date_creation` – TEXT  
- `nature_juridique` – TEXT  
- `forme_exercice_activite_principale` – TEXT  
- `etat_administratif` – TEXT  
- `statut_diffusion` – TEXT  
- `adresse` – TEXT  
- `date_mise_a_jour` – DATE  
- `file_name` – TEXT  

**Colonnes UL spécifiques personnes physiques**

- `nom` – TEXT  
- `nom_usage` – TEXT  
- `prenom` – TEXT  

**Colonne existante mais non alimentée par RNE**

- `activite_principale` – TEXT  

---

### 2.2 `siege`

Table représentant le siège de l’unité légale (établissement principal).

**Colonnes d’identification**

- `siren` – TEXT  
- `siret` – TEXT  

**Signalétique**

- `enseigne` – TEXT  
- `nom_commercial` – TEXT  

**Adresse**

- `pays` – TEXT  
- `code_pays` – TEXT  
- `commune` – TEXT  
- `code_postal` – TEXT  
- `code_commune` – TEXT (présent, non alimenté dans le mapping RNE)  
- `voie` – TEXT  
- `num_voie` – TEXT  
- `type_voie` – TEXT  
- `indice_repetition` – TEXT  
- `complement_localisation` – TEXT  
- `distribution_speciale` – TEXT  

**Traçabilité**

- `date_mise_a_jour` – DATE  
- `file_name` – TEXT  

---

### 2.3 `etablissement`

Table représentant les établissements secondaires issus de RNE.

**Colonnes**

- `siren` – TEXT  
- `siret` – TEXT  
- `date_mise_a_jour` – DATE  
- `file_name` – TEXT  

(Les adresses des établissements secondaires ne sont pas injectées dans cette table côté RNE.)

---

### 2.4 `activite`

Table listant les activités (siège + établissements secondaires).

**Colonnes**

- `siren` – TEXT  
- `siret` – TEXT  
- `code_category` – TEXT  
- `code_ape` – TEXT  
- `indicateur_principal` – BOOLEAN  
- `indicateur_prolongement` – BOOLEAN  
- `date_debut` – DATE  
- `form_exercice` – TEXT  
- `categorisation_activite1` – TEXT  
- `categorisation_activite2` – TEXT  
- `categorisation_activite3` – TEXT  
- `indicateur_activitee_ape` – BOOLEAN  
- `activite_rattachee_eirl` – BOOLEAN  
- `date_mise_a_jour` – DATE  
- `file_name` – TEXT  

---

### 2.5 `immatriculation`

Table regroupant les informations d’immatriculation, de capital et de cessation.

**Colonnes**

- `siren` – TEXT  
- `date_mise_a_jour` – DATE  
- `date_immatriculation` – DATE  
- `date_radiation` – DATE  
- `date_debut_activite` – TEXT  
- `indicateur_associe_unique` – TEXT  
- `capital_social` – REAL  
- `capital_variable` – TEXT  
- `devise_capital` – TEXT  
- `date_cloture_exercice` – TEXT  
- `duree_personne_morale` – INTEGER  
- `nature_entreprise` – TEXT (liste sérialisée, format JSON)  
- `file_name` – TEXT  

---

### 2.6 `dirigeant_pp`

Table des dirigeants personnes physiques.

**Colonnes**

- `siren` – TEXT  
- `nom` – TEXT  
- `nom_usage` – TEXT  
- `prenoms` – TEXT  (concaténation des prénoms)  
- `genre` – TEXT  
- `date_de_naissance` – TEXT  
- `nationalite` – TEXT  
- `situation_matrimoniale` – TEXT  
- `role` – TEXT  
- `date_mise_a_jour` – DATE  
- `file_name` – TEXT  
- `role_description` – TEXT  

---

### 2.7 `dirigeant_pm`

Table des dirigeants personnes morales.

**Colonnes**

- `siren` – TEXT  
- `siren_dirigeant` – TEXT  
- `denomination` – TEXT  
- `role` – TEXT  
- `pays` – TEXT  
- `forme_juridique` – TEXT  
- `date_mise_a_jour` – DATE  
- `file_name` – TEXT  
- `role_description` – TEXT  

---

## 3. Relations entre tables

Les relations suivantes sont **logiques** (jointures utilisées par les consommateurs) :

- **Unité légale ↔ siège**  
  - Clé de jointure : `unite_legale.siren = siege.siren`  
  - Cardinalité : 1 UL ↔ 0 ou 1 siège (RNE)

- **Unité légale ↔ établissements**  
  - Clé de jointure : `unite_legale.siren = etablissement.siren`  
  - Cardinalité : 1 UL ↔ 0..N établissements

- **Unité légale ↔ activités**  
  - Jointure principale : `unite_legale.siren = activite.siren`  
  - Jointure secondaire possible par SIRET avec `siege` / `etablissement`.

- **Unité légale ↔ dirigeants PP / PM**  
  - Clé de jointure : `unite_legale.siren = dirigeant_pp.siren`  
  - Clé de jointure : `unite_legale.siren = dirigeant_pm.siren`  
  - Cardinalité : 1 UL ↔ 0..N dirigeants (PP ou PM)

- **Unité légale ↔ immatriculation**  
  - Clé de jointure : `unite_legale.siren = immatriculation.siren`  
  - Cardinalité : 1 UL ↔ 0 ou 1 ligne d’immatriculation (dans le modèle RNE).

---

## 4. Index présents

- Un index est explicitement défini sur `immatriculation.siren` afin de faciliter les jointures et recherches par SIREN.

Pour les autres tables, la présence d’index supplémentaires dépend du schéma SQLite exact (non détaillé ici).

---

## 5. Contraintes et choix techniques

- La base RNE est stockée dans un fichier SQLite compressé (`rne_<date>.db.gz`) ; le fichier `.db` est utilisé localement pour la consolidation et les requêtes.
- Les relations entre tables s’appuient sur les colonnes `siren` et `siret`, mais sans clé étrangère déclarée dans la documentation RNE :
  - la cohérence est garantie par les traitements de construction (DAG `fill_rne_database`),  
  - les jointures sont faites au niveau des requêtes consommatrices.
- Les colonnes `date_mise_a_jour` et `file_name` sont présentes dans toutes les tables RNE, pour assurer la traçabilité des données (origine JSON + fraîcheur).
- Certains champs existent mais peuvent rester systématiquement NULL côté RNE (ex. `activite_principale` en `unite_legale`, `code_commune` en `siege`), car ils sont prévus pour d’autres sources ou usages ultérieurs.
