# 2.2 – Acquisition des données RNE (stock + flux)

## 1. Objectif
Décrire comment les données sources RNE sont récupérées depuis l’INPI avant leur consolidation dans la base quotidienne.

---

## 2. Sources externes

### 2.1 Stock annuel
- Ressource fournie sous forme d’**archive ZIP** contenant des fichiers **JSON**.  
- Téléchargement réalisé via le script **`get_stock.sh`**, exécuté par le DAG `get_rne_stock`.  
- Extraction locale puis dépôt dans MinIO sous `rne/stock/`.

### 2.2 Flux quotidiens
- Données issues de l’API **RNE Diff** (endpoint `companies/diff`).  
- Le DAG télécharge les flux **à partir de la date la plus récente déjà présente en MinIO (incluse)** jusqu’à la date courante.  
- Les flux sont enregistrés et envoyés vers MinIO sous forme de fichiers **compressés `.json.gz`**.

---

## 3. Stockage intermédiaire MinIO
- `rne/stock/` : fichiers JSON du stock annuel.  
- `rne/flux/` : fichiers de flux quotidiens au format **`.json.gz`**.

> L’acquisition ne génère **jamais** le répertoire `rne/database/` : celui-ci est produit exclusivement par le DAG `fill_rne_database`.

---

## 4. Orchestration

### 4.1 DAG `get_rne_stock`
- **Rôle** : télécharger, extraire et déposer le stock annuel.  
- **Déclenchement** : manuel (pas de cron).  
- **Étapes principales** :
  1. Préparation / nettoyage du dossier temporaire.  
  2. Téléchargement via `get_stock.sh`.  
  3. Extraction du ZIP.  
  4. Upload dans `rne/stock/`.  
- Des callbacks de succès/échec
